<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ppx_dbg (infer.Ppx_dbg)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">infer</a> &#x00BB; Ppx_dbg</nav><header class="odoc-preamble"><h1>Module <code><span>Ppx_dbg</span></code></h1><p>Extension point rewriter for debug trace logging</p><p>This ppx rewriter reads a cookie to determine whether to rewrite in &quot;debug&quot; mode or not. To enable &quot;debug&quot; mode, pass <code>--cookie 'ppx_dbg_enabled=&quot;1&quot;'</code> (or with <code>true</code> instead or <code>1</code>).</p><p>It rewrites <code>[%dbg] ~call ~retn ~rais</code> to a call <code>Dbg.dbg ~call ~retn ~rais fun_name</code> where <code>fun_name</code> is the value of <code>__FUNCTION__</code> at the call site. This is only done in debug mode, otherwise <code>[%dbg] ~call ~retn ~rais</code> is rewritten to <code>(fun k -&gt; k ())</code>.</p><p>Similarly, it rewrites <code>[%dbgs] ~call ~retn ~rais</code> to a call <code>Dbg.dbgs ~call ~retn ~rais fun_name</code>. This is only done in debug mode, otherwise <code>[%dbgs] ~call ~retn ~rais</code> is rewritten to <code>(fun x -&gt; x)</code>.</p><p>Similarly, <code>[%Dbg.info]</code>, <code>[%Dbg.infok]</code>, <code>[%Dbg.printf]</code>, <code>[%Dbg.fprintf]</code>, <code>[%Dbg.kprintf]</code>, and <code>[%Dbg.call]</code> are rewritten to their analogues in the <code>Dbg</code> module, or <code>()</code>; and <code>[%Dbg.retn]</code> is rewritten to a call to <code>Dbg.retn</code> or <code>(fun x -&gt; x)</code>.</p><p>For example, this enables writing</p><pre class="language-ocaml"><code>let func arg =
  [%dbg]
    ~call:(fun {pf} -&gt; pf &quot;@ %a&quot; pp_arg_type arg)
    ~retn:(fun {pf} -&gt; pf &quot;%a&quot; pp_result_type)
  @@ fun () -&gt; func arg</code></pre><p>or</p><pre class="language-ocaml"><code>let func arg =
  [%Dbg.call fun {pf} -&gt; pf &quot;@ %a&quot; pp_arg_type arg]
  ;
  func arg
  |&gt;
  [%Dbg.retn fun {pf} -&gt; pf &quot;%a&quot; pp_result_type]</code></pre><p>to trace calls to <code>func</code> in debug mode while completely compiling out the debug code in non-debug builds.</p><p>This mechanism can also be used e.g. to dynamically check assertions only in debug mode.</p><p>Additionally, <code>[%debug]</code> is rewritten to the compile-time boolean constant indicating if rewriting was done in debug mode.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-debug"><a href="#val-debug" class="anchor"></a><code><span><span class="keyword">val</span> debug : <span>bool <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand_debug"><a href="#val-expand_debug" class="anchor"></a><code><span><span class="keyword">val</span> expand_debug : 
  <span><span class="label">ctxt</span>:<span class="xref-unresolved">Ppxlib</span>.Expansion_context.Extension.t <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib__</span>.Import.expression</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-debug_extension"><a href="#val-debug_extension" class="anchor"></a><code><span><span class="keyword">val</span> debug_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.V3.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-debug_rule"><a href="#val-debug_rule" class="anchor"></a><code><span><span class="keyword">val</span> debug_rule : <span class="xref-unresolved">Ppxlib</span>.Context_free.Rule.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mapper"><a href="#val-mapper" class="anchor"></a><code><span><span class="keyword">val</span> mapper : <span class="xref-unresolved">Ppxlib</span>.Ast_traverse.map</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-impl"><a href="#val-impl" class="anchor"></a><code><span><span class="keyword">val</span> impl : <span><span class="xref-unresolved">Ppxlib__</span>.Import.Ast.structure <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppxlib__</span>.Import.Ast.structure</span></code></div></div></div></body></html>
