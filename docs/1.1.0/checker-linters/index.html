<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.1.0 docs-doc-page docs-doc-id-checker-linters" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">AST Language (AL) | Infer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fbinfer.com/docs/1.1.0/checker-linters"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.1.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.1.0"><meta data-rh="true" name="docsearch:version" content="1.1.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.1.0"><meta data-rh="true" property="og:title" content="AST Language (AL) | Infer"><meta data-rh="true" name="description" content="Declarative linting framework over the Clang AST."><meta data-rh="true" property="og:description" content="Declarative linting framework over the Clang AST."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://fbinfer.com/docs/1.1.0/checker-linters"><link data-rh="true" rel="alternate" href="https://fbinfer.com/docs/1.1.0/checker-linters" hreflang="en"><link data-rh="true" rel="alternate" href="https://fbinfer.com/docs/1.1.0/checker-linters" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WXX0LT0N1W-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"AST Language (AL)","item":"https://fbinfer.com/docs/1.1.0/checker-linters"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Infer RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Infer Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6T8Z3855RZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6T8Z3855RZ",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Infer" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e7478e84.css">
<script src="/assets/js/runtime~main.9996d003.js" defer="defer"></script>
<script src="/assets/js/main.3090bd59.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Support Ukraine 🇺🇦 <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Infer Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="Infer Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Infer</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/getting-started">Docs</a><a class="navbar__item navbar__link" href="/docs/support">Support</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://twitter.com/fbinfer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://www.facebook.com/inferstaticanalyzer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Facebook<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/facebook/infer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/1.1.0/getting-started">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/1.1.0/infer-workflow">User Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/1.1.0/all-issue-types">Analyses and Issue Types</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/all-issue-types">List of all issue types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-annotation-reachability">Annotation Reachability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-biabduction">Biabduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-bufferoverrun">Buffer Overrun Analysis (InferBO)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-config-checks-between-markers">Config Checks between Markers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-config-impact-analysis">Config Impact Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-cost">Cost: Runtime Complexity Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-eradicate">Eradicate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-fragment-retains-view">Fragment Retains View</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-immutable-cast">Immutable Cast</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-impurity">Impurity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-inefficient-keyset-iterator">Inefficient keySet Iterator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/1.1.0/checker-linters">AST Language (AL)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-litho-required-props">Litho &quot;Required Props&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-liveness">Liveness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-loop-hoisting">Loop Hoisting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-printf-args">`printf()` Argument Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-pulse">Pulse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-purity">Purity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-quandary">Quandary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-racerd">RacerD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-resource-leak-lab">Resource Leak Lab Exercise</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-dotnet-resource-leak">Resource Leak checker for .NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-siof">Static Initialization Order Fiasco</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-self-in-block">Self in Block</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-starvation">Starvation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-topl">Topl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.1.0/checker-uninit">Uninitialized Value</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/1.1.0/about-Infer">Foundations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/1.1.0/absint-framework">Contribute</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/1.1.0/versions">Versions</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Infer<!-- --> <b>1.1.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/getting-started">latest version</a></b> (<!-- -->1.2.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Analyses and Issue Types</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">AST Language (AL)</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.1.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AST Language (AL)</h1></header><p>Declarative linting framework over the Clang AST.</p>
<p><strong>***DEPRECATED***</strong> On end-of-life support, may be removed in the future.</p>
<p>Activate with <code>--linters</code>.</p>
<p>Supported languages:</p>
<ul>
<li>C/C++/ObjC: Yes</li>
<li>Java: No</li>
<li>C#/.Net: No</li>
</ul>
<p>For C/C++ and Objective-C languages, we provide a linters framework. These are
checks about the syntax of the program; it could be about a property, or about
code inside one method, or that a class or method have certain properties. We
provide <a href="#list-of-issue-types">a few checks by default</a> and we have developed a domain
specific language (DSL) to make it easier to write checks.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="al-a-declarative-language-for-writing-linters-in-infer">AL: A declarative language for writing linters in Infer<a href="#al-a-declarative-language-for-writing-linters-in-infer" class="hash-link" aria-label="Direct link to AL: A declarative language for writing linters in Infer" title="Direct link to AL: A declarative language for writing linters in Infer">​</a></h2>
<p>One of the major advantage of Infer when compared with other static analyzers is
the fact it performs sophisticated inter-procedural/inter-file analysis. That
is, Infer can detect bugs which involve tracking values through many procedure
calls and the procedures may live in different files. These may be very subtle
bugs and designing static analyses to do that is quite involved and normally
requires deep static analysis expertise.</p>
<p>However, there are many important software bugs that are confined in the code of
a single procedure (called intra-procedural). To detect these bugs simpler
analyses may suffice which do not require deep technical expertise in static
analysis. Often these bugs can be expressed by referring to the syntax of the
program, or the types of certain expressions. We have defined a new language to
easily design checkers which identify these kind of bugs. The language is called
AL (AST Language) and its main feature is the ability to reason about the
Abstract Syntax Tree of a program in a concise declarative way. AL&#x27;s checkers
are interpreted by Infer to analyze programs. Thus, to detect new kind of bugs
in Infer one can just write a check in AL. We will see in more detail later,
that for writing AL formulas we also need predicates: simple functions that
check a property of the AST. Predicates are written in OCaml inside Infer, thus
it requires a bit of OCaml knowledge and getting familiar with the OCaml data
structure for the clang AST.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-clang-ast">Getting the clang AST<a href="#getting-the-clang-ast" class="hash-link" aria-label="Direct link to Getting the clang AST" title="Direct link to Getting the clang AST">​</a></h2>
<p>When you write a linter that traverses the AST of some programs to check some
property, you probably need to understand what the AST looks like. You can get
the AST of programs using clang directly, or using Infer.</p>
<p>If you have a clang command <code>clang &lt;clang arguments&gt; File.m</code> then you can get
the AST with</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">clang &lt;clang arguments&gt; -Xclang -ast-dump -fsyntax-only File.m</span><br></span></code></pre></div></div>
<p>You can also get the AST using Infer. One advantage of this is that you don&#x27;t
need to know the speicifc clang command, just the general build command.
Moreover, what you get here is exactly the form of the AST that Infer has as
input.</p>
<p>For this you need to install an OCaml package <code>biniou</code> with
<code>opam install biniou</code>. See <a href="https://opam.ocaml.org/" target="_blank" rel="noopener noreferrer">the opam website</a> for
instructions on how to install opam.</p>
<p>Then, the AST can be created by Infer in debug mode. Call Infer with</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">infer --debug -- &lt;build command&gt;</span><br></span></code></pre></div></div>
<p>This will, among other things, generate a file <code>/path/to/File.m.ast.sh</code> for
every file <code>/path/to/File.m</code> that is being analyzed. Run this script with
<code>bash File.m.ast.sh</code> and a file <code>/path/to/File.m.ast.bdump</code> will be generated,
that contains the AST of the program in <code>bdump</code> format (similar to json). If you
get an error about <code>bdump</code> not being found you may need to run
<code>eval $(opam env)</code> to get the <code>bdump</code> executable (provided by the biniou opam
package) into your <code>PATH</code>.</p>
<p>For general info on the clang AST, you can check out
<a href="http://clang.llvm.org/docs/IntroductionToTheClangAST.html" target="_blank" rel="noopener noreferrer">clang&#x27;s website</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-al-to-write-linters">Using AL to write linters<a href="#using-al-to-write-linters" class="hash-link" aria-label="Direct link to Using AL to write linters" title="Direct link to Using AL to write linters">​</a></h2>
<p>Let&#x27;s start with an example. Suppose we want to write the following
Objective-C&#x27;s linter:</p>
<p><em>&quot;a property containing the word &#x27;delegate&#x27;, but not containing the word &#x27;queue&#x27;
should not be declared strong&quot;</em>.</p>
<p>We can write this property in the following way:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER STRONG_DELEGATE_WARNING = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LET name_contains_delegate =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        declaration_has_name(REGEXP(&quot;[dD]elegate&quot;));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LET name_does_not_contain_queue =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NOT declaration_has_name(REGEXP(&quot;[qQ]ueue&quot;));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SET report_when =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           name_contains_delegate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           AND name_does_not_contain_queue</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           AND is_strong_property()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE ObjCPropertyDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SET message = &quot;Property or ivar %decl_name% declared strong&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SET suggestion = &quot;In general delegates should be declared weak or assign&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SET severity = &quot;WARNING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span><br></span></code></pre></div></div>
<p>The linter definition starts with the keyword <code>DEFINE-CHECKER</code> followed by the
checker&#x27;s name. The first <code>LET</code> clause defines the <em>formula variable</em>
<code>name_contains_delegate</code> using the predicate <code>declaration_has_name</code> which return
true/false depending whether the property&#x27;s name contains a word in the language
of the regular expression <code>[dD]elegate</code>. In general a predicate is a simple
atomic formula evaluated on an AST node. The list of available predicates is in
the module
<a href="https://github.com/facebook/infer/blob/main/infer/src/clang/cPredicates.mli" target="_blank" rel="noopener noreferrer"><code>cPredicates.mli</code></a>
(this list is continuously growing and if you need a new predicate you can add
it in ocaml). Formula variables can be used to simplify other definitions. The
<code>SET report_when</code> is mandatory and defines a formula that, when evaluates to
true, will tell Infer to report an error. In the case above, the formula is
saying that we should report when visiting an <code>ObjCPropertyDecl</code> (that is the
AST node declaring a property in Objective-C) where it holds that: the name
contains &quot;delegate/Delegate&quot; (<code>name_contains_delegate</code>) and the name doesn&#x27;t
contain &quot;queue/Queue&quot; (<code>name_does_not_contain_queue</code>) and the node is defining a
&quot;strong&quot; property (<code>is_strong_property()</code>).</p>
<p>The <code>SET message</code> clause defines the error message that will be displayed to the
user. Notice that the message can include placeholders like <code>%decl_name%</code>.
Placeholders are evaluated by Infer and substituted by their current value when
the error message is reported. In this case the name of the declaration. The
<code>SET suggestion</code> clause define an optional hint to give to programmer on how to
fix the problem.</p>
<p>The general structure of a checker is the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER id_of_the_checker = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     LET formula = &lt;formula definition&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     LET ….</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET report_when = &lt;formula definition&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET name = &lt;optional name&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET message = &lt;error message to show the user&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET suggestion = &lt;optional suggestion to the user&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET doc_url = &lt;optional URL to documentation of the issue&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET severity = INFO | LIKE | ADVICE | WARNING | ERROR;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET mode = ON | OFF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET whitelist_path = {path1, path2, ..., pathn };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SET blacklist_path = {path1, path2, ..., pathn };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span><br></span></code></pre></div></div>
<p>The default severity is <code>WARNING</code> and the default mode is <code>ON</code>, so these are
optional. If the check is <code>OFF</code> it will only be available in debug mode (flags
<code>--debug</code> or <code>--linters-developer-mode</code>). <code>INFOs</code> are generally also not
reported, except with some specialzed flags. <code>name</code> and <code>doc_url</code> are used only
for CI comments at the moment (in Phabricator).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-paths">Defining Paths<a href="#defining-paths" class="hash-link" aria-label="Direct link to Defining Paths" title="Direct link to Defining Paths">​</a></h2>
<p><code>whitelist_path</code> and <code>blacklist_path</code> are optional, by default the rule is
enabled everywhere. For specifying paths, one can use either string constants
(<code>&quot;File.m&quot;</code>) or regexes (<code>REGEXP(&quot;path/to/.*&quot;)</code>) or variables. The variables
stand for a list of paths, and are defined in a separate block:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> GLOBAL-PATHS {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     path1 = {&quot;A.m&quot;, REGEXP(&quot;path/to/.*&quot;)};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-macros">Defining Macros<a href="#defining-macros" class="hash-link" aria-label="Direct link to Defining Macros" title="Direct link to Defining Macros">​</a></h2>
<p>It is possible to define macros that can be used in several checkers. This is
done in the following way:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">GLOBAL-MACROS {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LET is_subclass_of(x) =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        is_class(x) HOLDS-IN-SOME-SUPERCLASS-OF ObjCInterfaceDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> };</span><br></span></code></pre></div></div>
<p><code>GLOBAL-MACROS</code> is the section of an AL specification where one can define a
list of global macros. In the example we are defining the macro <code>is_subclass(x)</code>
which can now be used in checkers instead of its complex definition.</p>
<p>It is possible to import a library of macros and paths with the following
command:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#IMPORT &lt;library.al&gt;</span><br></span></code></pre></div></div>
<p>In an AL file, the command above import and make available all the macros and
paths defined in the <code>library.al</code> file.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="al-predicates">AL Predicates<a href="#al-predicates" class="hash-link" aria-label="Direct link to AL Predicates" title="Direct link to AL Predicates">​</a></h2>
<p>The simplest formulas we can write are predicates. They are defined inside
Infer. We provide a
<a href="https://github.com/facebook/infer/blob/main/infer/src/clang/cPredicates.mli" target="_blank" rel="noopener noreferrer">library</a>,
but if the predicate that you require is not available, you will need to extend
the library. Here are the some of the currently defined predicates:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">call_class_method (&quot;class_name&quot;, &quot;method_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call_function (&quot;method_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call_instance_method (&quot;class_name&quot;, &quot;method_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call_method (&quot;method_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">captures_cxx_references ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">context_in_synchronized_block ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declaration_has_name (&quot;decl_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declaration_ref_name (&quot;decl_ref_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">decl_unavailable_in_supported_ios_sdk ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">has_cast_kind(&quot;cast_kind&quot;) // useful in a cast node</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">has_type (&quot;type&quot;) // only builtin types, pointers and Objective-C classes available at the moment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">isa (&quot;class_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_assign_property ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_binop_with_kind (&quot;kind&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_class (&quot;class_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_const_var ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_global_var ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_ivar_atomic ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_ivar_readonly ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_method_property_accessor_of_ivar ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_node (&quot;node_name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_objc_constructor ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_objc_dealloc ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_objc_extension ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_objc_interface_named (&quot;name&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_property_pointer_type ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_strong_property ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_weak_property ()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_unop_with_kind (&quot;kind&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">method_return_type (&quot;type&quot;) // only builtin type, pointers, and Objective-C classes available at the moment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">objc_method_has_nth_parameter_of_type(&quot;type&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">using_namespace(&quot;namespace&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">within_responds_to_selector_block ()</span><br></span></code></pre></div></div>
<p>In general, the parameters of predicates can be constants, or variables, or
regular expressions. Variables are used in macros, see below. The syntax for
using regexes is <code>REGEX(&quot;your_reg_exp_here&quot;)</code>.</p>
<p><strong>NOTE:</strong> The predicates that expect types, such as <code>has_type</code> or
<code>method_return_type</code> or <code>objc_method_has_nth_parameter_of_type</code> also accept
regexes, but the syntax is a bit different: <code>REGEX(&#x27;your_reg_exp_here&#x27;)</code>, and
this regex can be embedded inside another string, for example:
<code>has_type(&quot;REGEXP(&#x27;NS.+&#x27;)*&quot; )</code> which stands for pointer to a class of name
starting with NS.</p>
<p>If you need to add a new predicate, write the predicate in
<a href="https://github.com/facebook/infer/blob/main/infer/src/clang/cPredicates.ml" target="_blank" rel="noopener noreferrer">cPredicates.ml</a>
and then register it in
<a href="https://github.com/facebook/infer/blob/main/infer/src/clang/cTL.ml#L728" target="_blank" rel="noopener noreferrer">CTL.ml</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="al-formulas">AL Formulas<a href="#al-formulas" class="hash-link" aria-label="Direct link to AL Formulas" title="Direct link to AL Formulas">​</a></h2>
<p>Formulas are defined using a variation of the
<a href="https://en.wikipedia.org/wiki/Computation_tree_logic" target="_blank" rel="noopener noreferrer"><em>CTL temporal logic</em></a>.
CTL is a logic expressing properties of a tree model. In the case of AL, the
tree is the AST of the program. Formulas are defined according to the following
grammar:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">formula ::= predicate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | NOT formula</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 OR formula2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 AND formula2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 IMPLIES formula2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 HOLDS-UNTIL formula2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 HOLDS-EVERYWHERE-UNTIL formula2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-EVENTUALLY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-EVERYWHERE-EVENTUALLY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-NEXT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-EVERYWHERE-NEXT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-ALWAYS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-EVERYWHERE-ALWAYS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | WHEN formula HOLDS-IN-NODE node-name-list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          | IN-NODE node-name-list WITH-TRANSITION transition-name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               formula HOLDS-EVENTUALLY</span><br></span></code></pre></div></div>
<p>The first four cases (<code>NOT</code>, <code>OR</code>, <code>AND</code>, <code>IMPLIES</code>) are classic boolean
operators with the usual semantics. The others are temporal operators describing
how the truth-value of a formula is evaluated in a tree. Let&#x27;s consider case by
case.</p>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>F1 <em>HOLDS-UNTIL</em> F2</td><td style="text-align:center">from the current node, there exists a path where F1 holds at every node until F2 becomes true</td></tr></tbody></table>
<p>An example is depicted in the following tree. When <code>F1</code> or <code>F2</code> hold in a node
this is indicated between square brackets. The formula <code>F1 HOLDS-UNTIL F2</code> holds
in the green nodes.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/holds_until-10287d3e5ce0372eb795ba68b526d5dd.jpeg" width="1544" height="860" class="img_ev3q"></p>
<hr>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>F <em>HOLDS-EVENTUALLY</em></td><td style="text-align:center">from the current node there exists a path where at some point F becomes true</td></tr></tbody></table>
<p>In the picture below, as <code>F</code> holds in <code>n10</code>, then <code>F HOLDS-EVENTUALLY</code> holds in
the green nodes <code>n1</code>, <code>n7</code>, <code>n10</code>. This is because from these nodes there is a
path reaching <code>n10</code> where <code>F</code> holds. Note that it holds for <code>n10</code> as well
because there exists a trivial path of length 0 from <code>n1</code> to itself.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/holds_eventually-c902ab130f9df49b713a915c9241065d.jpeg" width="771" height="428" class="img_ev3q"></p>
<hr>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-EVERYWHERE-EVENTUALLY</td><td style="text-align:center">in every path starting from the current node at some point F becomes true</td></tr></tbody></table>
<p>For example, in the tree below, the formula holds in every green node because
every paths starting from each of them eventually reaches a node where F holds.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/holds_everywhere_eventually-8cf1391d0166252988f7e31d473ee1d5.jpeg" width="1550" height="858" class="img_ev3q"></p>
<hr>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-NEXT</td><td style="text-align:center">from the current node (we are visiting) there exists a child where F is true</td></tr></tbody></table>
<p>In the tree below, the formula <code>F HOLDS-NEXT</code> it is true only in n1 as it&#x27;s the
only node with a child where <code>F</code> holds (node n3). In AL, <code>NEXT</code> is synonym of
child as, in terms of a path in the tree, a child is the next node.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/holds_next-e27db6b814684984c47ff598d0eef14d.jpeg" width="770" height="429" class="img_ev3q"></p>
<hr>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-EVERYWHERE-NEXT</td><td style="text-align:center">from the current node in every existing child F is true</td></tr></tbody></table>
<p>In the tree below, the formula <code>F HOLDS-EVERYWHERE-NEXT</code> it is true in n1 as
it&#x27;s the only node for which in every child <code>F</code> holds (node n2, n3, and n7).</p>
<p><img decoding="async" loading="lazy" src="/assets/images/holds_everywhere_next-eb3053c9e0b71452bc233680ed445789.jpeg" width="1540" height="866" class="img_ev3q"></p>
<hr>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-ALWAYS</td><td style="text-align:center">from the current node there exists a path where F holds at every node</td></tr></tbody></table>
<p>In the tree below <code>F HOLDS-ALWAYS</code> holds in <code>n1</code>, <code>n2</code>, <code>n8</code> because for each of
these nodes there exists a path where <code>F</code> holds at each node in the path.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/always_holds-0a66ba01c776ba452279cb7fd425932b.jpeg" width="1542" height="860" class="img_ev3q"></p>
<hr>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-EVERYWHERE-ALWAYS</td><td style="text-align:center">from the current node, in every path F holds at every node</td></tr></tbody></table>
<p><code>F HOLDS-EVERYWHERE-ALWAYS</code> holds in <code>n2</code>, <code>n4</code>, <code>n5</code>, and <code>n8</code> because when we
visit those nodes in every path that start from them <code>F</code> holds in every node.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/always_holds_everywhere-2126ca88fa7644f4666d56ffa83235b6.jpeg" width="1542" height="862" class="img_ev3q"></p>
<hr>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>WHEN F HOLDS-IN-NODE node1,…,nodeK</td><td style="text-align:center">we are in a node among node1,…,nodeK and F holds</td></tr></tbody></table>
<p><code>WHEN F HOLDS-IN-NODE</code> <code>n2</code>, <code>n7</code>, <code>n6</code> holds only in node <code>n2</code> as it is the
only node in the list <code>n2</code>, <code>n7</code>, <code>n6</code> where F holds.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/holds_in_node-8f5a6d826e8db658f196302bafedb2dd.jpeg" width="773" height="430" class="img_ev3q"></p>
<p>Let&#x27;s consider an example of checker using formula
<code>WHEN F HOLDS-IN-NODE node1,…,nodeK</code> for checking that a property with pointer
type should not be declared <em>&quot;assign&quot;</em>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER ASSIGN_POINTER_WARNING = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      SET report_when =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          WHEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            is_assign_property() AND is_property_pointer_type()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          HOLDS-IN-NODE ObjCPropertyDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      SET message = &quot;Property `%decl_name%` is a pointer type marked with the `assign` attribute&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      SET suggestion = &quot;Use a different attribute like `strong` or `weak`.&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      SET severity = &quot;WARNING&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span><br></span></code></pre></div></div>
<p>The checker uses two predefined predicates <code>is_assign_property()</code> and
<code>is_property_pointer_type()</code> which are true if the property being declared is
assign and has a pointer type respectively. We want to check both conditions
only on nodes declaring properties, i.e., <code>ObjCPropertyDecl</code>.</p>
<hr>
<table><thead><tr><th>Formula</th><th style="text-align:center">Semantic meaning</th></tr></thead><tbody><tr><td>IN-NODE node1,…, nodeK WITH-TRANSITION t F HOLDS-EVENTUALLY</td><td style="text-align:center">from the current node there exists a path which eventually reaches a node among “node1,…,nodeK” with a transition t reaching a child where F holds</td></tr></tbody></table>
<p>The following tree explain the concept:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/in_node_with_transition-43ca9dcc9203401a9e8c1f7b938d0e59.jpeg" width="1544" height="862" class="img_ev3q"></p>
<p>The concept of transition is needed because of the special structure of the
clang AST. Certain kind of nodes, for example statements, have a list of
children that are statements as well. In this case there is no special tag
attached to the edge between the node and the children. Other nodes have
records, where some of the fields point to other nodes. For example a node
representing a function declaration will have a record where one of the fields
is body. This is pointing to a statement representing the function&#x27;s body. For
records, sometimes we need to specify that we need a particular node reachable
via a particular field (i.e., a transition).</p>
<p><strong>Hint</strong> A good way to learn how to write checkers is looking at existing
checkers in the file
<a href="https://github.com/facebook/infer/blob/main/infer/lib/linter_rules/linters.al" target="_blank" rel="noopener noreferrer">linters.al</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-checks">Example checks<a href="#example-checks" class="hash-link" aria-label="Direct link to Example checks" title="Direct link to Example checks">​</a></h2>
<p>In the following we show a few examples of simple checks you may wish to write
and the corresponding formulas:</p>
<ul>
<li>A check for flagging a Objective-C class that inherits from a class that
shouldn&#x27;t be subclassed.</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER SUBCLASSING_TEST_EXAMPLE = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   SET report_when = is_class(&quot;A&quot;) HOLDS-IN-SOME-SUPERCLASS-OF ObjCInterfaceDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   SET message = &quot;This is subclassing A. Class A should not be subclassed.&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging an Objective-C instance method call:</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER CALL_INSTANCE_METHOD = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = call_instance_method(&quot;A&quot;, &quot;foo:&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not call this method&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging an Objective-C instance method call of any method of a
class:</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER CALL_ANY_INSTANCE_METHODS = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = call_instance_method(A, REGEXP(&quot;*&quot;));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not call any method of class A&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging an Objective-C class method call:</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER CALL_CLASS_METHOD = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = call_class_method(&quot;A&quot;, &quot;foo:&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not call this method&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging an Objective-C method call of a method with int return
type:</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_RETURN_METHOD = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = WHEN method_return_type(&quot;int&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE ObjCMethodDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Method return int&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging a variable declaration with type long</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_VAR_TYPE_CHECK = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = WHEN has_type(&quot;long&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	    HOLDS-IN-NODE VarDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Var %name% has type long&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging a method that has a parameter of type A*</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_PARAM_TYPE_CHECK = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LET method_has_a_parameter_with_type(x) =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN HOLDS-NEXT WITH-TRANSITION Parameters (has_type(x))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE ObjCMethodDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           method_has_a_parameter_with_type(&quot;A*&quot; );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Found a method with a parameter of type A&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging a method that has all the parameters of type A* (and at
least one)</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_PARAM_TYPE_CHECK2 = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LET method_has_at_least_a_parameter =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      WHEN HOLDS-NEXT WITH-TRANSITION Parameters (TRUE)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       HOLDS-IN-NODE ObjCMethodDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   LET method_has_all_parameter_with_type(x) =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN HOLDS-EVERYWHERE-NEXT WITH-TRANSITION Parameters (has_type(x))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE ObjCMethodDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = method_has_at_least_a_parameter AND</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    method_has_all_parameter_with_type(&quot;int&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;All the parameters of the method have type int&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging a method that has the 2nd parameter of type A*</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_NTH_PARAM_TYPE_CHECK = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    WHEN objc_method_has_nth_parameter_of_type(&quot;2&quot;, &quot;A*&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HOLDS-IN-NODE ObjCMethodDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Found a method with the 2nd parameter of type A*&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET severity = &quot;LIKE&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging a protocol that inherits from a given protocol.
<code>HOLDS-EVENTUALLY WITH-TRANSITION Protocol</code> means follow the <code>Protocol</code> branch
in the AST until the condition holds.</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_PROTOCOL_DEF_INHERITANCE = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LET is_subprotocol_of(x) = declaration_has_name(x) HOLDS-EVENTUALLY WITH-TRANSITION Protocol;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    WHEN is_subprotocol_of(&quot;P&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HOLDS-IN-NODE ObjCProtocolDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not inherit from Protocol P&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging when a constructor is defined with a parameter of a type
that implements a given protocol (or that inherits from it).
<code>HOLDS-NEXT WITH-TRANSITION Parameters</code> means, starting in the
<code>ObjCMethodDecl</code> node, follow the <code>Parameters</code> branch in the AST and check
that the condition holds there.</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_PROTOCOL_TYPE_INHERITANCE = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LET method_has_parameter_subprotocol_of(x) =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            WHEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             HOLDS-NEXT WITH-TRANSITION Parameters</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                (has_type_subprotocol_of(x))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             HOLDS-IN-NODE ObjCMethodDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      WHEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        declaration_has_name(REGEXP(&quot;^newWith.*:$&quot;)) AND</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        method_has_parameter_subprotocol_of(&quot;P&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      HOLDS-IN-NODE ObjCMethodDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not define parameters of type P.&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging a variable declaration of type NSArray applied to A.</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_GENERICS_TYPE = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      WHEN has_type(&quot;NSArray&lt;A&gt;*&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      HOLDS-IN-NODE VarDecl;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not create arrays of type A&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging using a property or variable that is not available in the
supported API. decl_unavailable_in_supported_ios_sdk is a predicate that works
on a declaration, checks the available attribute from the declaration and
compares it with the supported iOS SDK. Notice that we flag the occurrence of
the variable or property, but the attribute is in the declaration, so we need
the transition <code>PointerToDecl</code> that follows the pointer from the usage to the
declaration.</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER UNAVAILABLE_API_IN_SUPPORTED_IOS_SDK = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	WHEN HOLDS-NEXT WITH-TRANSITION PointerToDecl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	 (decl_unavailable_in_supported_ios_sdk() AND</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	HOLDS-IN-NODE DeclRefExpr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;%name% is not available in the required iOS SDK version&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging using a given namespace</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_USING_NAMESPACE = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = using_namespace(&quot;N&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not use namespace N&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<ul>
<li>A check for flagging the use of given enum constants</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER ENUM_CONSTANTS = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = is_enum_constant(REGEXP(&quot;MyName.*&quot;));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not use the enum MyName&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ast-info-in-messages">AST info in messages<a href="#ast-info-in-messages" class="hash-link" aria-label="Direct link to AST info in messages" title="Direct link to AST info in messages">​</a></h2>
<p>When you write the message of your rule, you may want to specify which
particular AST items were involved in the issue, such as a type or a variable
name. We have a mechanism for that, we specified a few placeholders that can be
used in rules with the syntax <code>%placeholder%</code> and it will be substituted by the
correct AST info. At the moment we have <code>%type%</code>, <code>%child_type%</code> and <code>%name%</code>
that print the type of the node, the type of the node&#x27;s child, and a string
representation of the node, respectively. As with predicates, we can add more as
needed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-your-rule">Testing your rule<a href="#testing-your-rule" class="hash-link" aria-label="Direct link to Testing your rule" title="Direct link to Testing your rule">​</a></h2>
<p>To test your rule you need to run it with Infer. If you are adding a new linter
you can test it in a separate al file that you can pass to Infer with the option
<code>--linters-def-file file.al</code>. Pass the option
<code>--linters-developer-mode --linter &lt;LINTER_NAME&gt;</code> to Infer to print debug
information and only run the linter you are developing, so it will be faster and
the debug info will be only about your linter.</p>
<p>To test your code, write a small example that triggers the rule. Then, run your
code with</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">infer --linters-developer-mode --linters-def-file file.al -- clang -c Test.m</span><br></span></code></pre></div></div>
<p>the bug should be printed in the screen, like, for instance:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">infer/tests/codetoanalyze/objcpp/linters/global-var/B.mm:34: warning: GLOBAL_VARIABLE_INITIALIZED_WITH_FUNCTION_OR_METHOD_CALL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Global variable kLineSize is initialized using a function or method call at line 34, column 1. If the function/method call is expensive,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  it can affect the starting time of the app.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  32.   static float kPadding = [A bar] ? 10.0 : 11.0; // Error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  33.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  34. &gt; static const float kLineSize = 1 / [A scale]; // Error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  35.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  36.   static const float ok = 37;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  37.</span><br></span></code></pre></div></div>
<p>Moreover, the bug can be found in the file <code>infer-out/report.json</code> where
<code>infer-out</code> is the results directory where Infer operates, that is created in
the current directory. You can specify a different directory with the option
<code>-o</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging">Debugging<a href="#debugging" class="hash-link" aria-label="Direct link to Debugging" title="Direct link to Debugging">​</a></h2>
<p>If there are syntax errors or other parsing errors with your al file, you will
get an error message when testing the rule, remember to use
<code>linters-developer-mode</code> when you are developing a rule. If the rule gets parsed
but still doesn&#x27;t behave as you expect, you can debug it, by adding the
following line to a test source file in the line where you want to debug the
rule: <code>//INFER_BREAKPOINT</code>. Then run infer again in linters developer mode, and
it will stop the execution of the linter on the line of the breakpoint. Then you
can follow the execution step by step. It shows the current formula that is
being evaluated, and the current part of the AST that is being checked. A red
node means that the formula failed, a green node means that it succeeded.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="demo">Demo<a href="#demo" class="hash-link" aria-label="Direct link to Demo" title="Direct link to Demo">​</a></h2>
<iframe src="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2Finferstaticanalyzer%2Fvideos%2F810308939133850%2F&amp;show_text=0&amp;width=400" width="500" height="500" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen=""></iframe>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="command-line-options-for-linters">Command line options for linters<a href="#command-line-options-for-linters" class="hash-link" aria-label="Direct link to Command line options for linters" title="Direct link to Command line options for linters">​</a></h2>
<p>The linters are run by default when you run Infer. However, there is a way of
running only the linters, which is faster than also running Infer. This is by
adding the option <code>--linters</code> to the analysis command as in this example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">infer run --linters -- clang -c Test.m</span><br></span></code></pre></div></div>
<p>There are a few other command-line options that are useful for using or
developing new linters in Infer. Read about them in the <a href="/docs/1.1.0/man-infer-capture"><code>infer capture</code> manual</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="list-of-issue-types">List of Issue Types<a href="#list-of-issue-types" class="hash-link" aria-label="Direct link to List of Issue Types" title="Direct link to List of Issue Types">​</a></h2>
<p>The following issue types are reported by this checker:</p>
<ul>
<li><a href="/docs/1.1.0/all-issue-types#assign_pointer_warning">ASSIGN_POINTER_WARNING</a></li>
<li><a href="/docs/1.1.0/all-issue-types#bad_pointer_comparison">BAD_POINTER_COMPARISON</a></li>
<li><a href="/docs/1.1.0/all-issue-types#component_with_multiple_factory_methods">COMPONENT_WITH_MULTIPLE_FACTORY_METHODS</a></li>
<li><a href="/docs/1.1.0/all-issue-types#cxx_reference_captured_in_objc_block">CXX_REFERENCE_CAPTURED_IN_OBJC_BLOCK</a></li>
<li><a href="/docs/1.1.0/all-issue-types#direct_atomic_property_access">DIRECT_ATOMIC_PROPERTY_ACCESS</a></li>
<li><a href="/docs/1.1.0/all-issue-types#discouraged_weak_property_custom_setter">DISCOURAGED_WEAK_PROPERTY_CUSTOM_SETTER</a></li>
<li><a href="/docs/1.1.0/all-issue-types#global_variable_initialized_with_function_or_method_call">GLOBAL_VARIABLE_INITIALIZED_WITH_FUNCTION_OR_METHOD_CALL</a></li>
<li><a href="/docs/1.1.0/all-issue-types#mutable_local_variable_in_component_file">MUTABLE_LOCAL_VARIABLE_IN_COMPONENT_FILE</a></li>
<li><a href="/docs/1.1.0/all-issue-types#pointer_to_const_objc_class">POINTER_TO_CONST_OBJC_CLASS</a></li>
<li><a href="/docs/1.1.0/all-issue-types#strong_delegate_warning">STRONG_DELEGATE_WARNING</a></li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/1.1.0/checker-inefficient-keyset-iterator"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Inefficient keySet Iterator</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/1.1.0/checker-litho-required-props"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Litho &quot;Required Props&quot;</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#al-a-declarative-language-for-writing-linters-in-infer" class="table-of-contents__link toc-highlight">AL: A declarative language for writing linters in Infer</a></li><li><a href="#getting-the-clang-ast" class="table-of-contents__link toc-highlight">Getting the clang AST</a></li><li><a href="#using-al-to-write-linters" class="table-of-contents__link toc-highlight">Using AL to write linters</a></li><li><a href="#defining-paths" class="table-of-contents__link toc-highlight">Defining Paths</a></li><li><a href="#defining-macros" class="table-of-contents__link toc-highlight">Defining Macros</a></li><li><a href="#al-predicates" class="table-of-contents__link toc-highlight">AL Predicates</a></li><li><a href="#al-formulas" class="table-of-contents__link toc-highlight">AL Formulas</a></li><li><a href="#example-checks" class="table-of-contents__link toc-highlight">Example checks</a></li><li><a href="#ast-info-in-messages" class="table-of-contents__link toc-highlight">AST info in messages</a></li><li><a href="#testing-your-rule" class="table-of-contents__link toc-highlight">Testing your rule</a></li><li><a href="#debugging" class="table-of-contents__link toc-highlight">Debugging</a></li><li><a href="#demo" class="table-of-contents__link toc-highlight">Demo</a></li><li><a href="#command-line-options-for-linters" class="table-of-contents__link toc-highlight">Command line options for linters</a></li><li><a href="#list-of-issue-types" class="table-of-contents__link toc-highlight">List of Issue Types</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/infer-workflow">User Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/about-Infer">Foundations</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/all-issue-types">Bug Types Reference</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/absint-framework">Contribute</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/support">Support</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/infer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/fbinfer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/inferstaticanalyzer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>